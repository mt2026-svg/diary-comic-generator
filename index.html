<!DOCTYPE html>
<html lang="ja">
<head>
    </head>
<body>
    <script>
async function generateComic() {
    const text = document.getElementById('diaryInput').value;
    if (!text) return alert("日記を入力してください");

    // ボタンを無効化し、ローディングを表示
    setLoading(true);

    const prompt = `以下の日記から4コマ漫画を作成してください。JSON形式で出力して。{"title":"題名","panels":[{"emoji":"絵文字","caption":"説明"}]} ※4枚分。 日記：${text}`;

    try {
        // ★ここが重要：Googleではなく、自分のサーバー（中継役）に送る
        const response = await fetch('/api/generate', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ prompt: prompt })
        });

        const data = await response.json();
        
        // Geminiからの回答を解析（ここはこれまでのロジックと同じ）
        const resultText = data.candidates[0].content.parts[0].text.replace(/```json|```/g, '');
        const json = JSON.parse(resultText);

        renderComic(json); // 漫画を描画する関数を呼ぶ

    } catch (e) {
        alert("エラーが発生しました。しばらく時間を置いて試してください。");
        console.error(e);
    } finally {
        setLoading(false);
    }
}
</script>
</body>
</html>
